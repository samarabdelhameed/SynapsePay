<p align="center">
  <img src="https://img.shields.io/badge/Solana-Winter%20Buildathon%202025-9945FF?style=for-the-badge&logo=solana&logoColor=white" alt="Solana Buildathon"/>
  <img src="https://img.shields.io/badge/Status-Active-00D18C?style=for-the-badge" alt="Status"/>
  <img src="https://img.shields.io/badge/License-MIT-blue?style=for-the-badge" alt="License"/>
</p>

<h1 align="center">ğŸš€ SynapsePay</h1>

<h3 align="center">AI-Powered AutoPay Agents on Solana</h3>

<p align="center">
  <strong>Pay-per-Action â€¢ Automation â€¢ Solana Actions â€¢ x402 â€¢ AI Agents â€¢ Marketplace</strong>
</p>

<p align="center">
  <a href="#-why-synapsepay">Why SynapsePay</a> â€¢
  <a href="#-core-features">Features</a> â€¢
  <a href="#-architecture">Architecture</a> â€¢
  <a href="#-tech-stack">Tech Stack</a> â€¢
  <a href="#-demo-scenarios">Demo</a> â€¢
  <a href="#-quick-start">Quick Start</a>
</p>

---

## ğŸ“‹ Overview

**SynapsePay** is a next-generation automation network that enables **AI-driven tasks**, **micro-transactions**, and **real-world device triggers** â€” all powered by **Solana's speed, scalability, and near-zero fees**.

Unlike traditional pay-per-use systems, SynapsePay combines:

| Component | Description |
|-----------|-------------|
| ğŸ¤– **AI Agents** | Multi-tool execution for diverse tasks |
| âš¡ **Solana Actions** | Direct transaction flows via social & web |
| ğŸ”„ **Automated Workflows** | Scheduled tasks & subscriptions |
| ğŸ’° **x402 Micropayments** | Gasless, instant micro-transactions |
| ğŸª **Agent Marketplace** | Discover & monetize custom agents |
| ğŸŒ **IoT Device Execution** | Bridge blockchain to physical world |

> **This makes SynapsePay the first system where users can pay 0.05 USDC to instantly trigger an AI task, device action, or on-chain workflow â€” fully automated.**

---

## â­ Why SynapsePay?

Most hackathon projects deliver simple "trigger and pay" apps.
**SynapsePay delivers a full automation network**, combining 3â€“4 ideas into one unified system:

| Feature | Status |
|---------|--------|
| âœ… AI execution | Multi-model support |
| âœ… On-chain automation | Solana-native |
| âœ… Pay-per-action billing | x402 protocol |
| âœ… Real device integration | IoT gateway |
| âœ… Social & Web2 integrations | Solana Actions |
| âœ… Marketplace for custom agents | Creator economy |

> ğŸ¯ **Perfectly aligned** with Solana's 2025 emphasis on **consumer apps, speed, automation, x402, and Solana Actions**.

---

## ğŸš€ Core Features

### 1. ğŸ¤– AI Agents (Multi-Tool Execution)

Each agent performs tasks on demand after a micro-payment:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ PDF Analysis          â”‚  ğŸ› Code Debugging              â”‚
â”‚  ğŸ¬ Video Summarization   â”‚  ğŸ“ Smart Contract Signing      â”‚
â”‚  ğŸ¨ Image Editing         â”‚  ğŸ–¼ï¸  NFT Generation             â”‚
â”‚  ğŸ“ˆ Trading Bot Execution â”‚  ğŸ“ IPFS Uploads                â”‚
â”‚  ğŸ’¼ Wallet Analytics      â”‚  ğŸ’¬ Multi-Model Chat            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Price Range:** `0.05 â€“ 0.5 USDC` per action, gasless via x402.

---

### 2. âš¡ Solana Actions Integration (SUPERPOWER)

Send a Solana transaction directly through:

- ğŸ¦ **Twitter** â€” Tweet triggers action
- ğŸ“§ **Email** â€” Inbox to blockchain
- ğŸ’¬ **WhatsApp** â€” Chat-based payments
- ğŸŒ **Websites** â€” Embedded action buttons
- ğŸ“± **QR Codes** â€” Scan and execute

**Example Automation Flow:**
```
Upload Image â†’ Auto-Pay â†’ AI converts to NFT â†’ Returns mint link in 2 seconds
```

---

### 3. ğŸ”„ Auto-Tasks & Subscriptions

Users can schedule automated recurring actions:

| Task Type | Example |
|-----------|---------|
| ğŸ“Š Daily Reports | Price alerts & portfolio summaries |
| ğŸ’± Weekly Rebalancing | USDC portfolio optimization |
| ğŸ’¾ Automated Backups | Data to Arweave/IPFS |
| ğŸ¨ Daily NFT Drops | AI-generated collections |
| ğŸ”” Wallet Monitoring | Balance & transaction alerts |
| ğŸ“ˆ Trading Triggers | Automated DeFi strategies |

> All tasks are billed with **auto micropayments** â€” set once, run forever.

---

### 4. ğŸª Agent Marketplace

Creators can publish and monetize their own agents:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CREATOR ECONOMY                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¤– AI Bots           â†’  Publish your trained models       â”‚
â”‚  ğŸ”Œ Device Triggers   â†’  Connect real-world hardware       â”‚
â”‚  ğŸ“Š Data Processors   â†’  Analytics & transformations       â”‚
â”‚  ğŸ”„ Automation Flows  â†’  Complex multi-step workflows      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Pays â†’ Creator Earns â†’ Platform Takes Fee
```

---

### 5. ğŸŒ Real-World Device / IoT Support

Bridge **Solana â†” Physical World** in real time:

| Device Type | Use Case |
|-------------|----------|
| ğŸ¤– Robots | Automated physical tasks |
| ğŸšª Smart Doors | Secure access control |
| ğŸš Drones | Aerial operations |
| ğŸ–¨ï¸ Printers | Document generation |
| ğŸ“· Cameras | Image capture triggers |
| ğŸ’¡ Smart Lights | Ambient control |

---

## ğŸ—ï¸ System Architecture

```mermaid
graph TB
    subgraph UserLayer["ğŸ‘¤ User Layer"]
        User[User]
        Wallet[Phantom / Solflare<br/>Wallet Provider]
        Social[Solana Actions<br/>Twitter / Email / QR]
    end

    subgraph Frontend["ï¿½ Frontend Layer - Port 5173"]
        Web[Web App<br/>React + Vite + ShadCN]
        Components[UI Components<br/>AgentCard, PaymentModal, Dashboard]
        ActionGen[Solana Actions Generator<br/>Blinks Integration]
    end

    subgraph Backend["ğŸ”§ Backend Layer"]
        Resource[Resource Server :8404<br/>Protected AI Endpoints]
        Facilitator[X402 Facilitator :8403<br/>/verify, /settle, /invoice]
        X402Lib[X402 Library<br/>Signatures & Validation]
        AIOrchestrator[AI Agent Orchestrator<br/>Task Router & Executor]
    end

    subgraph Blockchain["â›“ï¸ Solana Blockchain - Devnet/Mainnet"]
        Solana[Solana Network<br/>~400ms Finality]
        USDC[USDC-SPL Token<br/>Micropayments]
        Anchor[Anchor Programs<br/>Registry + Receipts]
        Scheduler[Task Scheduler<br/>Subscriptions & Cron]
    end

    subgraph AILayer["ğŸ¤– AI Agent Layer"]
        OpenAI[OpenAI<br/>GPT-4 / DALL-E]
        Anthropic[Anthropic<br/>Claude Models]
        Llama[Llama<br/>Open Source LLM]
        DeepSeek[DeepSeek<br/>Code & Analysis]
    end

    subgraph Storage["ğŸ’¾ Decentralized Storage"]
        IPFS[IPFS<br/>Result Storage]
        Arweave[Arweave<br/>Permanent Archive]
    end

    subgraph IoT["ğŸŒ IoT / Device Layer"]
        Robot[UGV Rover<br/>Physical Robot]
        SmartDevices[Smart Devices<br/>Lights / Doors / Drones]
    end

    User -->|1. Select Agent| Web
    User -->|1b. Solana Action| Social
    Social -->|Blink Request| ActionGen
    Web -->|2. Request Signature| Wallet
    Wallet -->|3. Signed TX| Web
    Web -->|4. X-PAYMENT Header| Resource
    Resource -->|5. Verify Payment| Facilitator
    Facilitator -->|Uses| X402Lib
    Resource -->|6. Settle Payment| Facilitator
    Facilitator -->|7. Submit TX| Solana
    Solana --> USDC
    Solana --> Anchor
    Anchor --> Scheduler
    Resource -->|8. Execute Task| AIOrchestrator
    AIOrchestrator --> OpenAI
    AIOrchestrator --> Anthropic
    AIOrchestrator --> Llama
    AIOrchestrator --> DeepSeek
    AIOrchestrator -->|9. Store Result| IPFS
    AIOrchestrator --> Arweave
    AIOrchestrator -->|10. Device Command| Robot
    AIOrchestrator --> SmartDevices
    Resource -->|11. Return Result| Web
    Robot -->|Video Stream| Web

    style User fill:#8b5cf6,color:#fff
    style Wallet fill:#a855f7,color:#fff
    style Social fill:#c084fc,color:#fff
    style Web fill:#3b82f6,color:#fff
    style Components fill:#60a5fa,color:#fff
    style ActionGen fill:#93c5fd,color:#000
    style Resource fill:#10b981,color:#fff
    style Facilitator fill:#059669,color:#fff
    style X402Lib fill:#34d399,color:#000
    style AIOrchestrator fill:#14b8a6,color:#fff
    style Solana fill:#9945FF,color:#fff
    style USDC fill:#2775CA,color:#fff
    style Anchor fill:#14F195,color:#000
    style Scheduler fill:#00D18C,color:#000
    style OpenAI fill:#412991,color:#fff
    style Anthropic fill:#D4A574,color:#000
    style Llama fill:#0467DF,color:#fff
    style DeepSeek fill:#4F46E5,color:#fff
    style IPFS fill:#65C2CB,color:#000
    style Arweave fill:#222326,color:#fff
    style Robot fill:#6366f1,color:#fff
    style SmartDevices fill:#818cf8,color:#fff
```

### Architecture Components

| Layer | Component | Description |
|-------|-----------|-------------|
| ğŸ‘¤ **User** | Phantom Wallet | Primary wallet for signing & payments |
| ğŸ‘¤ **User** | Solana Actions | Blinks via Twitter, Email, QR |
| ğŸŒ **Frontend** | React + Vite | Modern SPA with real-time updates |
| ğŸŒ **Frontend** | ShadCN UI | Premium component library |
| ğŸ”§ **Backend** | Resource Server | Protected AI agent endpoints |
| ğŸ”§ **Backend** | X402 Facilitator | Payment verification & settlement |
| ğŸ”§ **Backend** | AI Orchestrator | Routes tasks to appropriate AI model |
| â›“ï¸ **Blockchain** | Solana Network | Fast finality (~400ms) |
| â›“ï¸ **Blockchain** | USDC-SPL | Micropayments (0.05+ USDC) |
| â›“ï¸ **Blockchain** | Anchor Programs | Agent Registry + Receipt Storage |
| ğŸ¤– **AI** | Multi-Model | OpenAI, Claude, Llama, DeepSeek |
| ğŸ’¾ **Storage** | IPFS + Arweave | Decentralized result storage |
| ğŸŒ **IoT** | Device Bridge | Robot & smart device control |

### Data Flow Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. User selects AI Agent or triggers via Solana Action (Blink)         â”‚
â”‚  2. Phantom wallet signs payment transaction (gasless)                  â”‚
â”‚  3. X-PAYMENT header sent to Resource Server                            â”‚
â”‚  4. Facilitator verifies signature & settles on Solana                  â”‚
â”‚  5. AI Orchestrator executes task (OpenAI/Claude/Llama/DeepSeek)        â”‚
â”‚  6. Result stored on IPFS, CID recorded on-chain via Anchor             â”‚
â”‚  7. Receipt minted, result returned to user                             â”‚
â”‚  8. Optional: IoT device triggered (Robot/Smart Devices)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ X402 Payment Flow with Solana

### Complete Payment Lifecycle for AI Agent Execution

```mermaid
sequenceDiagram
    autonumber
    participant User
    participant Wallet as Wallet<br/>(Phantom)
    participant Web as SynapsePay App<br/>:5173
    participant Resource as AI Agent Server<br/>:8404
    participant Facilitator as X402 Facilitator<br/>:8403
    participant Blockchain as Solana Network<br/>(Devnet/Mainnet)

    Note over User,Blockchain: ğŸ” Payment Creation Phase
    User->>Web: Click "Run AI Agent" (e.g., PDF Summary)
    Web->>Wallet: Request Transaction Signature
    Note over Wallet: User reviews payment<br/>0.05 USDC-SPL (no gas fee)
    Wallet-->>Web: Signed Transaction

    Web->>Wallet: Request Payment Intent Signature
    Note over Wallet: User confirms agent task<br/>(gasless via x402)
    Wallet-->>Web: Payment Signature

    Note over User,Blockchain: ğŸ“¦ Payment Payload Assembly
    Web->>Web: Encode Payment Payload<br/>(signature + agent_id + task_metadata)
    Web->>Web: Create X-PAYMENT Header

    Note over User,Blockchain: âœ… Payment Verification Phase
    Web->>Resource: POST /agent/execute<br/>+ X-PAYMENT header
    Resource->>Facilitator: POST /verify<br/>(encoded payment payload)
    Facilitator->>Facilitator: Decode & Validate Signatures
    Facilitator->>Facilitator: Check USDC-SPL amount & recipient
    Facilitator-->>Resource: âœ“ Valid Payment

    Note over User,Blockchain: â›“ï¸ On-Chain Settlement Phase
    Resource->>Facilitator: POST /settle<br/>(same payload)
    Facilitator->>Blockchain: Transfer USDC-SPL<br/>(facilitator relays tx)
    Note over Blockchain: Solana Program:<br/>1. Validates signature<br/>2. Transfers USDC-SPL<br/>3. Mints Receipt NFT
    Blockchain-->>Facilitator: Transaction Signature + Receipt
    Facilitator-->>Resource: Settlement Response<br/>(txHash, receiptId, slot)

    Note over User,Blockchain: ğŸ¤– AI Agent Execution Phase
    Resource->>Resource: Trigger AI Agent<br/>(OpenAI/Claude/Llama)
    Resource->>Resource: Process Task<br/>(PDF/Image/Code)
    Resource->>Resource: Upload Result to IPFS
    Resource->>Blockchain: Store Result CID On-Chain

    Note over User,Blockchain: ğŸ‰ Result Delivered
    Resource-->>Web: 200 OK + Task Result
    Web-->>User: âœ“ Task Complete!<br/>View Result + Solscan Receipt

    Note over User,Blockchain: â±ï¸ Post-Execution Actions
    alt Subscription Active
        Resource->>Blockchain: Schedule Next Run
        Blockchain-->>Resource: Auto-trigger on schedule
    else One-Time Task
        User->>Web: Run another agent
    end
```

### Payment Flow Breakdown

| Phase | Description | Duration |
|-------|-------------|----------|
| ğŸ” **Creation** | User signs payment intent via Phantom | ~2 sec |
| ğŸ“¦ **Assembly** | Payload encoded with x402 headers | ~100 ms |
| âœ… **Verification** | Facilitator validates signatures | ~200 ms |
| â›“ï¸ **Settlement** | USDC-SPL transferred on Solana | ~400 ms |
| ğŸ¤– **Execution** | AI Agent processes task | 1-10 sec |
| ğŸ‰ **Delivery** | Result returned + receipt minted | ~500 ms |

> **Total Time:** Under 15 seconds for complete pay-to-result flow!

### Key Advantages of x402 on Solana

| Feature | Benefit |
|---------|---------|
| **Gasless UX** | Facilitator pays fees, user only signs |
| **Instant Settlement** | ~400ms finality on Solana |
| **Micropayment Ready** | 0.05 USDC viable (low fees) |
| **On-Chain Receipts** | Immutable proof via Anchor |
| **Multi-Agent Support** | Same flow for any agent type |

---

## ï¿½ Payment Protocol Details

### X402 Payment Payload Structure (Solana)

```mermaid
graph TB
    subgraph PayloadStructure["ğŸ“¦ Payment Payload"]
        Root[X-PAYMENT Header<br/>HTTP 402 Response]
        Root --> Encoded[Base64 Encoded JSON]

        Encoded --> Version[version: '1.0']
        Encoded --> PaymentType[paymentType: 'solana']
        Encoded --> Network[network: 'mainnet' | 'devnet']
        Encoded --> Payload[payload: SolanaPaymentPayload]

        subgraph SolanaPayload["ğŸ’³ Solana Payment Payload"]
            Payload --> PaymentId[paymentId: base58<br/>Unique Invoice ID]
            Payload --> Payer[payer: PublicKey<br/>User Wallet Address]
            Payload --> Recipient[recipient: PublicKey<br/>Agent Owner Address]
            Payload --> Amount[amount: string<br/>USDC in lamports]
            Payload --> TokenMint[tokenMint: PublicKey<br/>USDC-SPL Mint Address]
            Payload --> AgentId[agentId: string<br/>Target Agent Identifier]
            Payload --> TaskMeta[taskMetadata: JSON<br/>Task Parameters]
            Payload --> Expiry[expiresAt: number<br/>Unix Timestamp]
        end

        subgraph Signatures["âœï¸ Signatures"]
            Payload --> TxSig[transactionSignature: Ed25519]
            Payload --> PaymentSig[paymentIntentSignature: Ed25519]
            
            TxSig --> TxSigBytes[signature: base58<br/>64 bytes]
            TxSig --> TxPubkey[publicKey: base58<br/>32 bytes]
            
            PaymentSig --> PaySigBytes[signature: base58<br/>64 bytes]
            PaymentSig --> PayNonce[nonce: number<br/>Replay Protection]
        end
    end

    style Root fill:#3b82f6,color:#fff
    style Encoded fill:#60a5fa,color:#fff
    style Payload fill:#10b981,color:#fff
    style TxSig fill:#f59e0b,color:#fff
    style PaymentSig fill:#ef4444,color:#fff
    style PaymentId fill:#8b5cf6,color:#fff
    style Amount fill:#14b8a6,color:#fff
    style TokenMint fill:#9945FF,color:#fff
```

### Payload Field Definitions

| Field | Type | Description |
|-------|------|-------------|
| `version` | string | Protocol version (`"1.0"`) |
| `paymentType` | string | Blockchain type (`"solana"`) |
| `network` | string | `"mainnet-beta"` or `"devnet"` |
| `paymentId` | base58 | Unique invoice identifier (32 bytes) |
| `payer` | PublicKey | User's wallet address |
| `recipient` | PublicKey | Agent owner's wallet address |
| `amount` | string | Payment amount in USDC (6 decimals) |
| `tokenMint` | PublicKey | USDC-SPL token mint address |
| `agentId` | string | Target AI agent identifier |
| `taskMetadata` | JSON | Task-specific parameters |
| `expiresAt` | number | Invoice expiration timestamp |
| `transactionSignature` | Ed25519 | Signed Solana transaction |
| `paymentIntentSignature` | Ed25519 | Signed payment intent |
| `nonce` | number | Replay attack protection |

### Example Payment Payload

```json
{
  "version": "1.0",
  "paymentType": "solana",
  "network": "devnet",
  "payload": {
    "paymentId": "7xKXtg2CW87d9VqQzJkHT5J5E1mRQWz4vNrYhS9QT2Ni",
    "payer": "9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM",
    "recipient": "HN7cABqLq46Es1jh92dQQisAq662SmxELLLsHHe4YWrH",
    "amount": "50000",
    "tokenMint": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
    "agentId": "pdf-summarizer-v1",
    "taskMetadata": {
      "inputCID": "QmXoypiz...",
      "maxTokens": 1000,
      "language": "en"
    },
    "expiresAt": 1702166400,
    "transactionSignature": {
      "signature": "5KtP9...",
      "publicKey": "9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM"
    },
    "paymentIntentSignature": {
      "signature": "4RmQ7...",
      "nonce": 1702166000
    }
  }
}
```

### Signature Verification Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. EXTRACT: Decode Base64 X-PAYMENT header                             â”‚
â”‚  2. VALIDATE: Check version, network, expiry                            â”‚
â”‚  3. VERIFY TX: Ed25519 verify transactionSignature with payer pubkey    â”‚
â”‚  4. VERIFY INTENT: Ed25519 verify paymentIntentSignature                â”‚
â”‚  5. CHECK NONCE: Ensure nonce not previously used (replay protection)   â”‚
â”‚  6. VERIFY AMOUNT: Confirm amount matches agent price                   â”‚
â”‚  7. VERIFY TOKEN: Confirm tokenMint is valid USDC-SPL                   â”‚
â”‚  8. SETTLE: Submit transaction to Solana network                        â”‚
â”‚  9. RECEIPT: Mint on-chain receipt via Anchor program                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Token Addresses

| Token | Network | Mint Address |
|-------|---------|--------------|
| USDC | Mainnet | `EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v` |
| USDC | Devnet | `4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU` |

---

## ğŸ”„ Payment States & Transitions

### Payment Lifecycle State Machine

```mermaid
stateDiagram-v2
    [*] --> INVOICE_CREATED: createInvoice()

    INVOICE_CREATED --> PENDING: settlePayment()<br/>(user signs tx)
    INVOICE_CREATED --> EXPIRED: Time > expiresAt

    PENDING --> EXECUTING: verifyPayment()<br/>(facilitator confirms)
    PENDING --> FAILED: Invalid signature<br/>or insufficient funds

    EXECUTING --> COMPLETED: agentExecute()<br/>(AI task success)
    EXECUTING --> FAILED: Agent error<br/>or timeout

    COMPLETED --> CLAIMED: claimPayment()<br/>(agent owner)
    COMPLETED --> RECEIPT_MINTED: mintReceipt()<br/>(on-chain proof)

    RECEIPT_MINTED --> CLAIMED: claimPayment()<br/>(agent owner)

    EXPIRED --> REFUNDED: refundPayment()<br/>(payer)
    FAILED --> REFUNDED: autoRefund()<br/>(system)

    CLAIMED --> [*]
    REFUNDED --> [*]

    note right of INVOICE_CREATED
        ğŸ“‹ Invoice generated
        â±ï¸ 5 min expiry window
        ğŸ’° Price locked
    end note

    note right of PENDING
        âœ… Payment received
        ğŸ”’ USDC in escrow
        â³ Awaiting verification
    end note

    note right of EXECUTING
        ğŸ¤– AI Agent running
        ğŸ“Š Task in progress
        ğŸ’¾ Storing results
    end note

    note right of COMPLETED
        âœ“ Task finished
        ğŸ“ Result on IPFS
        ğŸ« Ready for receipt
    end note

    note right of CLAIMED
        ğŸ’¸ USDC transferred
        to agent owner
    end note

    note right of REFUNDED
        â†©ï¸ USDC returned
        to payer
    end note
```

### State Definitions

| State | Description | Next Actions |
|-------|-------------|--------------|
| `INVOICE_CREATED` | Invoice generated, awaiting payment | `settlePayment()`, expires after 5 min |
| `PENDING` | Payment received, USDC in escrow | `verifyPayment()` by facilitator |
| `EXECUTING` | AI Agent processing task | Wait for completion or timeout |
| `COMPLETED` | Task finished, result stored on IPFS | `mintReceipt()`, `claimPayment()` |
| `RECEIPT_MINTED` | On-chain receipt created | `claimPayment()` |
| `CLAIMED` | Agent owner received USDC | Terminal state |
| `EXPIRED` | Invoice timed out before payment | `refundPayment()` if paid |
| `FAILED` | Verification or execution error | Auto-refund triggered |
| `REFUNDED` | USDC returned to payer | Terminal state |

### Anchor Program Instructions

```rust
// Payment State Transitions (Anchor)

#[derive(AnchorSerialize, AnchorDeserialize, Clone, PartialEq)]
pub enum PaymentState {
    InvoiceCreated,
    Pending,
    Executing,
    Completed,
    ReceiptMinted,
    Claimed,
    Expired,
    Failed,
    Refunded,
}

// Instructions
pub fn create_invoice(ctx: Context<CreateInvoice>, amount: u64, agent_id: String) -> Result<()>
pub fn settle_payment(ctx: Context<SettlePayment>, signature: [u8; 64]) -> Result<()>
pub fn verify_payment(ctx: Context<VerifyPayment>) -> Result<()>
pub fn complete_task(ctx: Context<CompleteTask>, result_cid: String) -> Result<()>
pub fn mint_receipt(ctx: Context<MintReceipt>) -> Result<()>
pub fn claim_payment(ctx: Context<ClaimPayment>) -> Result<()>
pub fn refund_payment(ctx: Context<RefundPayment>) -> Result<()>
```

### State Transition Rules

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INVOICE_CREATED â†’ PENDING                                              â”‚
â”‚    âœ“ User must sign valid transaction                                   â”‚
â”‚    âœ“ USDC amount must match invoice                                     â”‚
â”‚    âœ“ Invoice must not be expired                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PENDING â†’ EXECUTING                                                    â”‚
â”‚    âœ“ Facilitator verifies Ed25519 signature                             â”‚
â”‚    âœ“ USDC successfully transferred to escrow                            â”‚
â”‚    âœ“ Nonce not previously used                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EXECUTING â†’ COMPLETED                                                  â”‚
â”‚    âœ“ AI Agent returns valid result                                      â”‚
â”‚    âœ“ Result CID stored on IPFS/Arweave                                  â”‚
â”‚    âœ“ No timeout (max 60 seconds)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  COMPLETED â†’ CLAIMED                                                    â”‚
â”‚    âœ“ Only agent owner can claim                                         â”‚
â”‚    âœ“ Platform fee (5%) deducted                                         â”‚
â”‚    âœ“ Remaining USDC transferred to owner                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FAILED/EXPIRED â†’ REFUNDED                                              â”‚
â”‚    âœ“ Automatic refund on failure                                        â”‚
â”‚    âœ“ Manual refund available for expired invoices                       â”‚
â”‚    âœ“ Full amount returned to payer                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ Tech Stack

### Smart Contracts (Solana)

| Component | Technology |
|-----------|------------|
| Language | Rust (Anchor Framework) |
| Payments | x402 Integration |
| Subscriptions | On-chain Manager |
| Registry | Agent Registration |
| Scheduler | Automated Task Triggers |

### Backend

| Component | Technology |
|-----------|------------|
| Runtime | Bun + TypeScript |
| Payments | x402 Relay Service |
| Orchestration | AI Agent Orchestrator |
| IoT | Device Bridge (Optional) |

### Frontend

| Component | Technology |
|-----------|------------|
| Framework | React + ShadCN UI |
| Wallet | Solana Wallet Adapter |
| Actions | Solana Actions Generator |
| Dashboard | Real-time Task Monitoring |

### AI Services

| Provider | Capabilities |
|----------|--------------|
| OpenAI | GPT-4, DALL-E, Whisper |
| Anthropic | Claude Models |
| Llama | Open Source LLM |
| DeepSeek | Code & Analysis |

---

## ğŸ³ Docker Service Dependencies

```mermaid
graph LR
    subgraph DockerNetwork["ğŸ³ Docker Network: synapsepay-network"]
        direction TB
        
        subgraph Core["Core Services"]
            Validator[solana-validator<br/>:8899<br/>Local RPC Node]
            Facilitator[x402-facilitator<br/>:8403<br/>Payment Gateway]
            Resource[resource-server<br/>:8404<br/>AI Agent API]
            Web[web-frontend<br/>:5173<br/>React Dashboard]
        end
        
        subgraph AI["AI Services"]
            AIRunner[ai-orchestrator<br/>:8500<br/>Model Router]
            LlamaLocal[llama-local<br/>:11434<br/>Ollama LLM]
        end
        
        subgraph Storage["Storage Services"]
            IPFS[ipfs-node<br/>:5001<br/>Result Storage]
            Redis[redis<br/>:6379<br/>Task Queue]
        end
        
        subgraph IoT["IoT Services"]
            DeviceBridge[device-bridge<br/>:8600<br/>Hardware Gateway]
        end
    end

    Validator -->|health check| Facilitator
    Facilitator -->|depends on| Resource
    Resource -->|routes tasks| AIRunner
    AIRunner -->|local inference| LlamaLocal
    Resource -->|stores results| IPFS
    Resource -->|task queue| Redis
    Resource -->|device commands| DeviceBridge
    Facilitator -.->|serves| Web
    Resource -.->|API calls| Web
    IPFS -.->|CID lookup| Web

    style Validator fill:#9945FF,color:#fff
    style Facilitator fill:#10b981,color:#fff
    style Resource fill:#8b5cf6,color:#fff
    style Web fill:#3b82f6,color:#fff
    style AIRunner fill:#14b8a6,color:#fff
    style LlamaLocal fill:#0467DF,color:#fff
    style IPFS fill:#65C2CB,color:#000
    style Redis fill:#DC382D,color:#fff
    style DeviceBridge fill:#6366f1,color:#fff
```

### Service Configuration

| Service | Port | Description | Dependencies |
|---------|------|-------------|--------------|
| `solana-validator` | 8899 | Local Solana RPC node | None |
| `x402-facilitator` | 8403 | Payment verification & settlement | `solana-validator` |
| `resource-server` | 8404 | AI Agent execution API | `x402-facilitator`, `redis` |
| `web-frontend` | 5173 | React dashboard | `resource-server` |
| `ai-orchestrator` | 8500 | Routes tasks to AI models | `redis` |
| `llama-local` | 11434 | Local LLM via Ollama | None |
| `ipfs-node` | 5001 | Decentralized result storage | None |
| `redis` | 6379 | Task queue & caching | None |
| `device-bridge` | 8600 | IoT hardware gateway | None |

### Docker Compose Commands

```bash
# Start all services
docker-compose up -d

# Start core services only
docker-compose up -d solana-validator x402-facilitator resource-server web-frontend

# Start with AI services
docker-compose --profile ai up -d

# Start with IoT support
docker-compose --profile iot up -d

# View logs
docker-compose logs -f resource-server

# Stop all services
docker-compose down
```

---

## ğŸ§ª Demo Scenarios

Judges can test these live workflows:

### Scenario 1: PDF Summary
```
ğŸ’µ Pay 0.05 USDC â†’ ğŸ¤– AI Summarizes PDF â†’ ğŸ“„ Instant Result
```

### Scenario 2: NFT Minting
```
ğŸ–¼ï¸ Upload Image â†’ ğŸ’µ Auto-Pay â†’ ğŸ¨ NFT Minted â†’ ğŸ”— Mint Link Returned
```

### Scenario 3: Social Trigger
```
ğŸ¦ Connect Twitter â†’ ğŸ“ Tweet Action â†’ âš¡ AI Task Triggered
```

### Scenario 4: Subscription
```
ğŸ“… Schedule Daily â†’ ğŸ“Š Portfolio Report â†’ ğŸ”„ Auto-Generated
```

### Scenario 5: Marketplace
```
ğŸª Browse Agents â†’ ğŸ’µ Pay Per Use â†’ ğŸ¤– External Agent Runs
```

### Scenario 6: IoT Demo (Optional)
```
ğŸ’µ Pay 0.1 USDC â†’ ğŸ¤– Robot Moves / ğŸ’¡ LED Activates
```

---

## ğŸ¯ Solana Buildathon Alignment

| Criteria | How SynapsePay Delivers |
|----------|------------------------|
| **Uses Solana Meaningfully** | Micropayments, Actions, gasless execution â€” all require Solana's speed |
| **Consumer-Facing** | Simple UX, instant tasks via AI |
| **Technical Depth** | x402 + Solana Actions + AI + on-chain execution + marketplace |
| **Originality** | Not a clone â€” a full automation network |
| **Real Demo Scenarios** | Judges can test 10+ workflows instantly |

---

## ğŸ“¦ Quick Start

### Prerequisites

- Node.js 18+ or Bun
- Solana CLI
- Anchor Framework
- Phantom Wallet

### Installation

```bash
# Clone the repository
git clone https://github.com/samarabdelhameed/Solana-SynapsePay.git
cd Solana-SynapsePay

# Install dependencies
bun install

# Configure environment
cp .env.example .env
# Edit .env with your keys

# Start development server
bun run dev
```

### Environment Variables

```env
SOLANA_RPC_URL=https://api.devnet.solana.com
RELAYER_PRIVATE_KEY=your_key_here
OPENAI_API_KEY=your_key_here
IPFS_API_KEY=your_key_here
```

---

## ğŸ“„ Deliverables

| Deliverable | Status |
|-------------|--------|
| âœ… GitHub Repository | Complete |
| âœ… Demo Video (2-3 min) | Ready |
| âœ… Architecture Diagrams | Included |
| âœ… Flow Documentation | Documented |
| âœ… Smart Contracts | Deployed |
| âœ… Frontend + Backend | Functional |
| âœ… Sample Agents | Available |
| âœ… Action Generators | Implemented |

---

## ğŸ”¥ Summary

> **SynapsePay is an AI-powered automation network on Solana that enables pay-per-action tasks, auto-subscriptions, device triggers, and Solana Actions â€” all driven by AI Agents and gasless x402 micropayments.**

---

## ğŸ¤ Contributing

We welcome contributions! Please see our [Contributing Guide](CONTRIBUTING.md) for details.

---

## ğŸ“œ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

---

## ğŸ‘¥ Team

| Role | Contact |
|------|---------|
| **Project Lead** | Samar Abdelhameed |
| **GitHub** | [@samarabdelhameed](https://github.com/samarabdelhameed) |

---

<p align="center">
  <strong>Built with â¤ï¸ for Solana Winter Buildathon 2025</strong>
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Powered%20by-Solana-9945FF?style=flat-square&logo=solana&logoColor=white" alt="Powered by Solana"/>
</p>
